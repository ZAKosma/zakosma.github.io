<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>Hello WebXR!</title>
    <!-- three.js -->
    <script src="https://unpkg.com/three@0.126.0/build/three.js"></script>
</head>
<body>
<button onclick="activateVR()">Start Hello My VR</button>
<script>
    async function activateVR() {
        const canvas = document.createElement("canvas");
        document.body.appendChild(canvas);
        const gl = canvas.getContext("webgl", {xrCompatible: true});

        const aspectRatio = window.innerWidth / window.innerHeight;
        const myCam = new THREE.PerspectiveCamera(70, aspectRatio, 0.01, 10);
        myCam.position.z = 1;

        const stereoCamera = new THREE.StereoCamera();
        stereoCamera.aspect = 0.5;
        stereoCamera.eyeSep = 0.02; // Eye separation

        const scene = new THREE.Scene();

        const geometry = new THREE.BoxGeometry(0.2, 0.2, 0.2);
        const material = new THREE.MeshNormalMaterial();

        const mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);

        const renderer = new THREE.WebGLRenderer({ canvas: canvas, context: gl, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        // Animation function is now inside activateVR
        function animation(time) {
            mesh.rotation.x = time / 2000;
            mesh.rotation.y = time / 1000;

            stereoCamera.update(myCam);

            renderer.setScissorTest(true);

            renderer.setScissor(0, 0, window.innerWidth / 2, window.innerHeight);
            renderer.setViewport(0, 0, window.innerWidth / 2, window.innerHeight);
            renderer.render(scene, stereoCamera.cameraL);

            renderer.setScissor(window.innerWidth / 2, 0, window.innerWidth / 2, window.innerHeight);
            renderer.setViewport(window.innerWidth / 2, 0, window.innerWidth / 2, window.innerHeight);
            renderer.render(scene, stereoCamera.cameraR);

            renderer.setScissorTest(false);
        }

        renderer.setAnimationLoop(animation);
    }
</script>
</body>
</html>